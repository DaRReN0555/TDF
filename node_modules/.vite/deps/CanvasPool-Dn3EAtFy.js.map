{"version":3,"file":"CanvasPool-Dn3EAtFy.js","names":[],"sources":["../../pixi.js/lib/rendering/batcher/gpu/getTextureBatchBindGroup.mjs","../../pixi.js/lib/rendering/renderers/shared/texture/CanvasPool.mjs"],"sourcesContent":["import { BindGroup } from '../../renderers/gpu/shader/BindGroup.mjs';\nimport { Texture } from '../../renderers/shared/texture/Texture.mjs';\n\n\"use strict\";\nconst cachedGroups = {};\nfunction getTextureBatchBindGroup(textures, size, maxTextures) {\n  let uid = 2166136261;\n  for (let i = 0; i < size; i++) {\n    uid ^= textures[i].uid;\n    uid = Math.imul(uid, 16777619);\n    uid >>>= 0;\n  }\n  return cachedGroups[uid] || generateTextureBatchBindGroup(textures, size, uid, maxTextures);\n}\nfunction generateTextureBatchBindGroup(textures, size, key, maxTextures) {\n  const bindGroupResources = {};\n  let bindIndex = 0;\n  for (let i = 0; i < maxTextures; i++) {\n    const texture = i < size ? textures[i] : Texture.EMPTY.source;\n    bindGroupResources[bindIndex++] = texture.source;\n    bindGroupResources[bindIndex++] = texture.style;\n  }\n  const bindGroup = new BindGroup(bindGroupResources);\n  cachedGroups[key] = bindGroup;\n  return bindGroup;\n}\n\nexport { getTextureBatchBindGroup };\n//# sourceMappingURL=getTextureBatchBindGroup.mjs.map\n","import { DOMAdapter } from '../../../../environment/adapter.mjs';\nimport { nextPow2 } from '../../../../maths/misc/pow2.mjs';\nimport { GlobalResourceRegistry } from '../../../../utils/pool/GlobalResourceRegistry.mjs';\n\n\"use strict\";\nclass CanvasPoolClass {\n  constructor(canvasOptions) {\n    this._canvasPool = /* @__PURE__ */ Object.create(null);\n    this.canvasOptions = canvasOptions || {};\n    this.enableFullScreen = false;\n  }\n  /**\n   * Creates texture with params that were specified in pool constructor.\n   * @param pixelWidth - Width of texture in pixels.\n   * @param pixelHeight - Height of texture in pixels.\n   */\n  _createCanvasAndContext(pixelWidth, pixelHeight) {\n    const canvas = DOMAdapter.get().createCanvas();\n    canvas.width = pixelWidth;\n    canvas.height = pixelHeight;\n    const context = canvas.getContext(\"2d\");\n    return { canvas, context };\n  }\n  /**\n   * Gets a Power-of-Two render texture or fullScreen texture\n   * @param minWidth - The minimum width of the render texture.\n   * @param minHeight - The minimum height of the render texture.\n   * @param resolution - The resolution of the render texture.\n   * @returns The new render texture.\n   */\n  getOptimalCanvasAndContext(minWidth, minHeight, resolution = 1) {\n    minWidth = Math.ceil(minWidth * resolution - 1e-6);\n    minHeight = Math.ceil(minHeight * resolution - 1e-6);\n    minWidth = nextPow2(minWidth);\n    minHeight = nextPow2(minHeight);\n    const key = (minWidth << 17) + (minHeight << 1);\n    if (!this._canvasPool[key]) {\n      this._canvasPool[key] = [];\n    }\n    let canvasAndContext = this._canvasPool[key].pop();\n    if (!canvasAndContext) {\n      canvasAndContext = this._createCanvasAndContext(minWidth, minHeight);\n    }\n    return canvasAndContext;\n  }\n  /**\n   * Place a render texture back into the pool.\n   * @param canvasAndContext\n   */\n  returnCanvasAndContext(canvasAndContext) {\n    const canvas = canvasAndContext.canvas;\n    const { width, height } = canvas;\n    const key = (width << 17) + (height << 1);\n    canvasAndContext.context.resetTransform();\n    canvasAndContext.context.clearRect(0, 0, width, height);\n    this._canvasPool[key].push(canvasAndContext);\n  }\n  clear() {\n    this._canvasPool = {};\n  }\n}\nconst CanvasPool = new CanvasPoolClass();\nGlobalResourceRegistry.register(CanvasPool);\n\nexport { CanvasPool, CanvasPoolClass };\n//# sourceMappingURL=CanvasPool.mjs.map\n"],"mappings":";;;AAIA,IAAM,eAAe,EAAE;AACvB,SAAS,yBAAyB,UAAU,MAAM,aAAa;CAC7D,IAAI,MAAM;AACV,MAAK,IAAI,IAAI,GAAG,IAAI,MAAM,KAAK;AAC7B,SAAO,SAAS,GAAG;AACnB,QAAM,KAAK,KAAK,KAAK,SAAS;AAC9B,WAAS;;AAEX,QAAO,aAAa,QAAQ,8BAA8B,UAAU,MAAM,KAAK,YAAY;;AAE7F,SAAS,8BAA8B,UAAU,MAAM,KAAK,aAAa;CACvE,MAAM,qBAAqB,EAAE;CAC7B,IAAI,YAAY;AAChB,MAAK,IAAI,IAAI,GAAG,IAAI,aAAa,KAAK;EACpC,MAAM,UAAU,IAAI,OAAO,SAAS,KAAK,QAAQ,MAAM;AACvD,qBAAmB,eAAe,QAAQ;AAC1C,qBAAmB,eAAe,QAAQ;;CAE5C,MAAM,YAAY,IAAI,UAAU,mBAAmB;AACnD,cAAa,OAAO;AACpB,QAAO;;;;;ACnBT,IAAM,kBAAN,MAAsB;CACpB,YAAY,eAAe;AACzB,OAAK,cAA8B,uBAAO,OAAO,KAAK;AACtD,OAAK,gBAAgB,iBAAiB,EAAE;AACxC,OAAK,mBAAmB;;;;;;;CAO1B,wBAAwB,YAAY,aAAa;EAC/C,MAAM,SAAS,WAAW,KAAK,CAAC,cAAc;AAC9C,SAAO,QAAQ;AACf,SAAO,SAAS;EAChB,MAAM,UAAU,OAAO,WAAW,KAAK;AACvC,SAAO;GAAE;GAAQ;GAAS;;;;;;;;;CAS5B,2BAA2B,UAAU,WAAW,aAAa,GAAG;AAC9D,aAAW,KAAK,KAAK,WAAW,aAAa,KAAK;AAClD,cAAY,KAAK,KAAK,YAAY,aAAa,KAAK;AACpD,aAAW,SAAS,SAAS;AAC7B,cAAY,SAAS,UAAU;EAC/B,MAAM,OAAO,YAAY,OAAO,aAAa;AAC7C,MAAI,CAAC,KAAK,YAAY,KACpB,MAAK,YAAY,OAAO,EAAE;EAE5B,IAAI,mBAAmB,KAAK,YAAY,KAAK,KAAK;AAClD,MAAI,CAAC,iBACH,oBAAmB,KAAK,wBAAwB,UAAU,UAAU;AAEtE,SAAO;;;;;;CAMT,uBAAuB,kBAAkB;EAEvC,MAAM,EAAE,OAAO,WADA,iBAAiB;EAEhC,MAAM,OAAO,SAAS,OAAO,UAAU;AACvC,mBAAiB,QAAQ,gBAAgB;AACzC,mBAAiB,QAAQ,UAAU,GAAG,GAAG,OAAO,OAAO;AACvD,OAAK,YAAY,KAAK,KAAK,iBAAiB;;CAE9C,QAAQ;AACN,OAAK,cAAc,EAAE;;;AAGzB,IAAM,aAAa,IAAI,iBAAiB;AACxC,uBAAuB,SAAS,WAAW"}